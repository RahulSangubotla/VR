<!DOCTYPE html>
<html>
<head>
    <title>EduVerse AR Debug</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.4.0/dist/aframe-extras.min.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        
        /* 1. FORCE HIDE THE VR BUTTON */
        .a-enter-vr-button { display: none !important; }

        /* 2. CUSTOM UI */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 100;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        #start-btn {
            pointer-events: auto;
            margin-bottom: 50%;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            background: #00D2FF;
            color: white;
            border: none;
            border-radius: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: block;
        }

        /* 3. DEBUG LOGGER (So we know why it fails) */
        #debug-log {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 90%;
            color: yellow;
            font-family: monospace;
            font-size: 14px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>

<body>
    <div id="debug-log">Status: Initializing...</div>

    <div id="overlay">
        <button id="start-btn">START AR EXPERIENCE</button>
    </div>

    <script>
        function log(msg) {
            document.getElementById('debug-log').innerHTML += "<br>" + msg;
            console.log(msg);
        }

        // --- CHECK AR SUPPORT IMMEDIATELY ---
        window.onload = function() {
            log("Checking AR Support...");
            if (navigator.xr) {
                navigator.xr.isSessionSupported('immersive-ar')
                .then((isSupported) => {
                    if (isSupported) {
                        log("✅ AR IS Supported on this device.");
                    } else {
                        log("❌ AR NOT Supported. (Will fall back to VR)");
                        alert("Your phone does not appear to support WebXR AR. Make sure 'Google Play Services for AR' is installed.");
                    }
                });
            } else {
                log("❌ WebXR API not found (Use Chrome on Android).");
            }
        };

        // --- COMPONENT: TAP TO PLACE ---
        AFRAME.registerComponent('ar-spawner', {
            init: function () {
                this.reticle = document.querySelector('#reticle');
                this.model = document.querySelector('#molecule-model');
                this.scene = this.el.sceneEl;
                this.placed = false;

                this.scene.addEventListener('click', () => {
                    if (this.scene.is('ar-mode') && this.reticle.getAttribute('visible') && !this.placed) {
                        this.model.setAttribute('position', this.reticle.getAttribute('position'));
                        this.model.setAttribute('rotation', this.reticle.getAttribute('rotation'));
                        this.model.setAttribute('visible', 'true');
                        this.reticle.setAttribute('visible', 'false');
                        this.placed = true;
                        log("Molecule Placed!");
                    }
                });
            }
        });

        // --- COMPONENT: START BUTTON LOGIC ---
        AFRAME.registerComponent('start-ar', {
            init: function() {
                const btn = document.getElementById('start-btn');
                const scene = this.el.sceneEl;

                btn.addEventListener('click', () => {
                    log("Attempting to enter AR...");
                    btn.style.display = 'none';
                    
                    // Request AR Session specifically
                    scene.enterVR(); 
                });

                scene.addEventListener('enter-vr', () => {
                    if (scene.is('ar-mode')) {
                        log("✅ Entered AR Mode Success!");
                    } else {
                        log("⚠️ Entered VR Mode (Split Screen) - AR Failed.");
                    }
                });
                
                scene.addEventListener('ar-hit-test-start', () => {
                    log("Scanning surface...");
                });
                
                scene.addEventListener('ar-hit-test-achieved', () => {
                    log("Surface found! Tap to place.");
                });
            }
        });
    </script>

    <a-scene 
      start-ar
      vr-mode-ui="enabled: false"
      webxr="optionalFeatures: hit-test, dom-overlay; overlayElement: #overlay" 
      ar-hit-test="target: #reticle; type: map"
      renderer="alpha: true; colorManagement: true;"
      ar-spawner>

        <a-light type="directional" intensity="1" position="-1 2 2"></a-light>
        <a-light type="ambient" intensity="0.6"></a-light>

        <a-entity id="reticle" visible="false">
            <a-ring color="white" radius-inner="0.10" radius-outer="0.15" rotation="-90 0 0" opacity="0.8"></a-ring>
        </a-entity>

        <a-entity id="molecule-model" visible="false">
            <a-sphere color="red" radius="0.3" position="0 0 0"></a-sphere>
            <a-sphere color="white" radius="0.2" position="-0.5 -0.4 0"></a-sphere>
            <a-sphere color="white" radius="0.2" position="0.5 -0.4 0"></a-sphere>
        </a-entity>

    </a-scene>
</body>
</html>