<!DOCTYPE html>
<html>
<head>
    <title>EduVerse AR - Safe Mode</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.4.0/dist/aframe-extras.min.js"></script>

    <style>
        /* Force hiding the default VR button */
        .a-enter-vr-button { display: none !important; }
        
        /* A simple start button that disappears forever when clicked */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #222; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        #start-btn {
            padding: 20px 40px; font-size: 24px; background: #00D2FF; color: white;
            border: none; border-radius: 10px; font-weight: bold;
        }
        #status-log {
            color: yellow; margin-top: 20px; font-family: monospace;
        }
    </style>
</head>

<body>
    <div id="start-screen">
        <button id="start-btn">ENTER AR</button>
        <div id="status-log">Ready.</div>
    </div>

    <script>
        const log = (msg) => document.getElementById('status-log').innerText = msg;

        AFRAME.registerComponent('ar-logic', {
            init: function () {
                const scene = this.el.sceneEl;
                const btn = document.getElementById('start-btn');
                const startScreen = document.getElementById('start-screen');
                const reticle = document.getElementById('reticle');
                const model = document.getElementById('molecule');

                // 1. CLICK TO START
                btn.addEventListener('click', () => {
                    log("Requesting AR Session...");
                    scene.enterVR(); // This requests the WebXR session
                });

                // 2. LISTEN FOR SUCCESS
                scene.addEventListener('enter-vr', () => {
                    if (scene.is('ar-mode')) {
                        // SUCCESS: Hide the start screen so we can see the camera
                        startScreen.style.display = 'none';
                    } else {
                        // FAIL: We are in split screen. Tell the user.
                        log("⚠️ FAILED: Still in Split Screen. Try resetting Chrome Flags.");
                    }
                });

                // 3. TAP TO PLACE (3D World Logic)
                scene.addEventListener('click', () => {
                    if (scene.is('ar-mode') && reticle.getAttribute('visible')) {
                        model.setAttribute('position', reticle.getAttribute('position'));
                        model.setAttribute('rotation', reticle.getAttribute('rotation'));
                        model.setAttribute('visible', 'true');
                        
                        // Add a simple animation to show it worked
                        model.setAttribute('animation', 'property: scale; from: 0 0 0; to: 0.5 0.5 0.5; dur: 500; easing: easeOutElastic');
                    }
                });
            }
        });
    </script>

    <a-scene 
      ar-logic
      vr-mode-ui="enabled: false"
      webxr="optionalFeatures: hit-test;" 
      ar-hit-test="target: #reticle; type: map"
      renderer="alpha: true; physicallyCorrectLights: true;">

        <a-light type="directional" position="-1 2 2" intensity="1.5"></a-light>
        <a-light type="ambient" intensity="0.8"></a-light>

        <a-ring id="reticle" color="white" radius-inner="0.10" radius-outer="0.15" rotation="-90 0 0" visible="false"></a-ring>

        <a-entity id="molecule" visible="false" scale="0.5 0.5 0.5">
            <a-sphere color="red" radius="0.3"></a-sphere>
            <a-sphere color="white" radius="0.15" position="0.4 0.2 0"></a-sphere>
            <a-sphere color="white" radius="0.15" position="-0.4 0.2 0"></a-sphere>
            <a-text value="Tap to Place" position="0 0.5 0" align="center" color="black" scale="2 2 2"></a-text>
        </a-entity>

    </a-scene>
</body>
</html>